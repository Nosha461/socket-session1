<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background-color: #f5f5f5; }
    .container { display: flex; height: 100vh; }
    .sidebar {
      width: 220px;
      background-color: #2b1b3d;
      color: white;
      padding: 20px;
    }
    .sidebar h2 { margin-top: 0; }
    .chat-section { flex: 1; display: flex; flex-direction: column; background-color: #fff; }
    .chat-header {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #ccc; padding: 10px 20px;
    }
    .logout-btn {
      background-color: #6c1ea8; color: white; border: none;
      padding: 8px 16px; border-radius: 6px; cursor: pointer;
    }
    .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; }
    .chat-footer { display: flex; border-top: 1px solid #ccc; padding: 10px; }
    .chat-footer input { flex: 1; padding: 10px; border-radius: 4px; border: 1px solid #ccc; }
    .chat-footer button {
      background-color: #34a853; color: white; border: none;
      padding: 10px 20px; margin-left: 10px; border-radius: 4px; cursor: pointer;
    }
   .message { padding: 8px 12px; margin: 5px 0; border-radius: 10px; max-width: 70%; }
.own { background-color: #d4f8d4; align-self: flex-end; }
.other { background-color: #ffffff; align-self: flex-start; }

  </style>
</head>
<body>

<div class="container">
  <div class="sidebar">
    <h2>Online Users</h2>
    <ul id="onlineUsers"></ul>
  </div>
  <div class="chat-section">
    <div class="chat-header">
      <h3 id="welcomeText">Welcome</h3>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-footer">
      <input type="text" id="messageInput" placeholder="Your message..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>
</div>

<script src="http://localhost:5000/socket.io/socket.io.js"></script>
<script>
const token = localStorage.getItem("token");
const socket = io("http://localhost:5000", { auth: { token } });

const params = new URLSearchParams(window.location.search);
const username = params.get("username") || "Guest";
document.getElementById("welcomeText").textContent = `Welcome, ${username}`;

// إرسال اسم المستخدم عند الانضمام

socket.emit("join", username);


// استقبال الرسائل

socket.on("chat message", (data) => {
    const div = document.createElement("div");
    div.classList.add("message");

    if(data.user === username) {
        div.classList.add("own"); // رسالة لي أنا → أخضر ويمين
    } else {
        div.classList.add("other"); // رسالة من غيري → أبيض وشمال
    }

    div.textContent = data.message;
    document.getElementById("chatBody").appendChild(div);
});


// استقبال المستخدمين الجدد
socket.on("userJoined", (name) => {
  const li = document.createElement("li");
  li.textContent = name;
  document.getElementById("onlineUsers").appendChild(li);
});

// إرسال الرسائل
const sendBtn = document.getElementById("sendBtn");
const input = document.getElementById("messageInput");

sendBtn.addEventListener("click", () => {
  const msg = input.value.trim();
  if (msg) {
    socket.emit("chat message", { user: username, message: msg }); // نرسل اسم المرسل + الرسالة
    input.value = "";
  }
});

function logout() {
  localStorage.removeItem("token");
  window.location.href = "login.html";
}
</script>

</body>
</html>










